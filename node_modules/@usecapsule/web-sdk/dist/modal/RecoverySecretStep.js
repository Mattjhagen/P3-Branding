import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { ModalStep } from './steps';
import { Box, Button, Input, Menu, MenuItem, MenuButton, Text, VStack, useClipboard, MenuList, Flex, Link, } from '@chakra-ui/react';
import './css/modal.css';
import { CopyIcon, ChevronDownIcon, EmailIcon, DownloadIcon, CheckIcon } from '@chakra-ui/icons';
import { lighten } from 'polished';
import { getMailtoLink } from '../utils/emailUtils';
export function RecoverySecretStep({ currentStep, recoveryShare, email, setCurrentStep }) {
    const LIGHT_GRAY = '#212327';
    const HOVER_COLOR = '#f1fff1';
    const backupDecryptionKey = JSON.parse(recoveryShare || '{}').backupDecryptionKey;
    const { onCopy, hasCopied } = useClipboard(backupDecryptionKey);
    const handleDownload = () => {
        const element = document.createElement('a');
        const file = new Blob([backupDecryptionKey], { type: 'text/plain' });
        element.href = URL.createObjectURL(file);
        element.download = 'recovery.txt';
        document.body.appendChild(element); // Required for this to work in FireFox
        element.click();
    };
    if (currentStep !== ModalStep.SECRET) {
        return null;
    }
    return (_jsxs(VStack, { flex: 1, children: [_jsxs(Box, { style: { marginTop: 36, width: '324px' }, display: "flex", flexDirection: "column", alignItems: "center", children: [_jsx(Text, { textColor: "brand.text", fontSize: "22px", children: "Now let's save your" }), _jsx(Text, { textColor: "brand.text", fontSize: "22px", fontWeight: "bold", children: _jsx("b", { children: "recovery secret" }) })] }), _jsx(Box, { style: { width: '274px', marginTop: '20px' }, children: _jsx(Text, { fontWeight: 500, lineHeight: '18px', fontSize: '16px', textAlign: 'center', children: "You'll need this if you lose your device. Copy it and save it somewhere safe." }) }), _jsxs(Box, { width: '274px', children: [_jsx(Text, { alignSelf: "start", fontSize: "12px", fontWeight: 500, lineHeight: '16px', textColor: "#838587", marginTop: "28px", children: "Recovery secret" }), _jsxs(Box, { position: "relative", width: "fit-content", marginTop: '4px', children: [_jsx(Input, { textColor: "brand.text", value: backupDecryptionKey, borderColor: 'brand.frameColor', border: "1px solid rgba(255, 255, 255, 0.1)", background: "rgba(255, 255, 255, 0.05)", paddingRight: "115px", whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis", readOnly: true }), _jsx(Button, { position: "absolute", right: "6px", top: "50%", transform: "translateY(-50%)", onClick: onCopy, leftIcon: hasCopied ? _jsx(CheckIcon, {}) : _jsx(CopyIcon, {}), bg: LIGHT_GRAY, _hover: { bg: HOVER_COLOR, textColor: '#000000' }, textColor: 'brand.text', height: "75%", children: hasCopied ? 'Copied!' : 'Copy' })] }), _jsxs(Menu, { children: [_jsx(MenuButton, { textColor: "brand.text", bg: LIGHT_GRAY, as: Button, rightIcon: _jsx(ChevronDownIcon, {}), width: '274px', marginTop: '12px', _hover: { bg: HOVER_COLOR, textColor: 'black' }, _expanded: { bg: LIGHT_GRAY, textColor: 'brand.text' }, children: "More backup options" }), _jsxs(MenuList, { textColor: "brand.text", bg: LIGHT_GRAY, width: '274px', border: 'none', children: [_jsx(Link, { href: getMailtoLink(email, backupDecryptionKey), isExternal: true, children: _jsx(MenuItem, { _focus: { bg: lighten(0.05, LIGHT_GRAY) }, justifyContent: "center", children: _jsxs(Flex, { alignItems: "center", children: [_jsx(EmailIcon, { mr: 2 }), "Email"] }) }) }), _jsx(MenuItem, { _focus: { bg: lighten(0.05, LIGHT_GRAY) }, justifyContent: "center", onClick: handleDownload, children: _jsxs(Flex, { alignItems: "center", children: [_jsx(DownloadIcon, { mr: 2 }), "Download"] }) })] })] }), _jsxs(Text, { marginTop: '16px', lineHeight: '18px', fontSize: '14px', children: ["Learn how to use your recovery secret on ", ' ', _jsx(Link, { isExternal: true, href: "https://www.usecapsule.com", textDecoration: "underline", children: "usecapsule.com" }), "."] }), _jsx(Button, { onClick: () => setCurrentStep(ModalStep.SETUP_2FA), marginTop: '44px', width: '100%', children: _jsx(Text, { fontWeight: 500, lineHeight: '28px', fontSize: '16px', color: "black", children: "I've saved my recovery secret" }) })] })] }));
}
